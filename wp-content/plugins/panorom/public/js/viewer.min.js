"use strict";var panoromViewer=function(){var output={},pnrmViewerDiv;if(document.querySelector(".pnrm-viewer")){console.log("panorom viewer running"),document.addEventListener("DOMContentLoaded",(function(){var topViewerDivs;document.querySelectorAll(".pnrm-viewer").forEach((function(viewerDiv){populatePanoromForDiv(viewerDiv,(function(mainConfig,mainConfigText,panoObj){mainConfigArray.push(mainConfig),mainConfigTextArray.push(mainConfigText),panoObjArray.push(panoObj)}))}))}));var mainConfigArray=[];output.printMainConfig=function(){mainConfigArray.forEach((function(mainConfig){console.log(mainConfig)}))};var mainConfigTextArray=[];output.printMainConfigText=function(){mainConfigTextArray.forEach((function(mainConfigText){console.log(mainConfigText)}))};var panoObjArray=[];return output.panoObjArray=panoObjArray,output}function populatePanoromForDiv(viewerDiv,callback){var pnrmDiv=viewerDiv.querySelector(".pnrm-div"),pano,configJson,config={},tourId,dataToSend={action:"get_tour",post_id:pnrmDiv.dataset.tourId};function checkStartSceneInShortcode(){var startSceneId=pnrmDiv.dataset.startSceneId;if(startSceneId&&void 0!==config.scenes[startSceneId]){let tmpAutoRotate,tmpAutoRotateStopDelay;config.default.firstScene&&(tmpAutoRotate=config.scenes[config.default.firstScene].autoRotate,delete config.scenes[config.default.firstScene].autoRotate,tmpAutoRotateStopDelay=config.scenes[config.default.firstScene],delete config.scenes[config.default.firstScene].autoRotateStopDelay),config.default.firstScene=startSceneId,tmpAutoRotate&&(config.scenes[config.default.firstScene].autoRotate=tmpAutoRotate),tmpAutoRotateStopDelay&&(config.scenes[config.default.firstScene].autoRotateStopDelay=tmpAutoRotateStopDelay)}}function applyConfigToMainLogo(){var mainLogo=viewerDiv.querySelector(".custom-logo"),mainLogoImg=document.createElement("img");config.default.pnrmLogoUrl&&(mainLogoImg.src=config.default.pnrmLogoUrl,mainLogo.appendChild(mainLogoImg),mainLogo.classList.add("show")),config.default.pnrmLogoSizeFixed&&(mainLogoImg.style.width=config.default.pnrmLogoSizeFixed+"px"),config.default.pnrmLogoLink&&(mainLogo.href=config.default.pnrmLogoLink)}function handlePnrmAudio(){const iconAudioOn=pnrmDiv.querySelector(".icon-audio-on"),iconAudioOff=pnrmDiv.querySelector(".icon-audio-off"),audioEl=document.createElement("audio");let playStarted=!1;config.default.pnrmAudioFileUrl&&(audioEl.src=config.default.pnrmAudioFileUrl,audioEl.setAttribute("controls",""),audioEl.style.display="none",viewerDiv.appendChild(audioEl),iconAudioOff.classList.add("show"),viewerDiv.onclick=viewerDiv.ontouchstart=function(){config.default.pnrmAudioStartOnClick||playStarted||(audioEl.play(),playStarted=!0)},iconAudioOn.onclick=iconAudioOn.ontouchstart=function(e){e.preventDefault(),audioEl.pause()},iconAudioOff.onclick=iconAudioOff.ontouchstart=function(e){e.preventDefault(),audioEl.play()},audioEl.onplay=function(){iconAudioOff.classList.remove("show"),iconAudioOn.classList.add("show")},audioEl.onpause=function(){iconAudioOn.classList.remove("show"),iconAudioOff.classList.add("show")})}function handleFullscreen(){if(!config.default.pnrmFullscreen)return;if(viewerDiv.querySelector(".box-main-interface").classList.add("pnrm-fullscreen"),document.querySelector("body").style.overflowY="hidden",document.querySelector("body").appendChild(viewerDiv),1===window.history.length)return;const iconGoBack=pnrmDiv.querySelector(".pnrm-icon-go-back");iconGoBack.classList.add("show"),iconGoBack.onclick=function(){iconGoBack.style.pointerEvents="none",history.back()},window.addEventListener("pageshow",(function(){iconGoBack.style.pointerEvents="auto"}))}function handleThumbnailBar(){if(!config.default.pnrmThumbnailBar)return;const tBar=new PnrmTumbnailBar({topContainer:viewerDiv.querySelector(".box-main-interface"),isActivated:!!pnrm_ajax_object.is_activated,isEditorPage:!1});tBar.draw(config,pano)}function handlePreviewSceneChange(sceneId){var scene=config.scenes[sceneId];if(scene&&scene.previewTitle){var infoDisplay=viewerDiv.querySelector(".pnrm-pnlm-panorama-info"),titleBox=viewerDiv.querySelector(".pnrm-pnlm-title-box");infoDisplay&&titleBox&&(titleBox.textContent=scene.previewTitle,infoDisplay.style.display="inline")}}function correctHttpProtocol(){for(let key in config.scenes){var scene=config.scenes[key],panoramaNoHttp=scene.panorama.replace(/^https?:\/\//,"");scene.panorama=window.location.protocol+"//"+panoramaNoHttp;var thumbnailNoHttp=scene.thumbnail.replace(/^https?:\/\//,"");scene.thumbnail=window.location.protocol+"//"+thumbnailNoHttp}}function removeDefaultSceneHfov(){for(let key in config.scenes){var scene;delete config.scenes[key].hfov}}function calculateHfovFromPnrmHfov(){var widthOfDiv=viewerDiv.getBoundingClientRect().width,initialHfov=100;void 0===config.default.pnrmHfov&&(config.default.pnrmHfov=100),config.default.hfov=widthOfDiv<600?Number(config.default.pnrmHfov)-20:widthOfDiv>1440?Number(config.default.pnrmHfov)+10:Number(config.default.pnrmHfov)}function calculateHeightForScreenSizes(){var widthOfDiv=viewerDiv.getBoundingClientRect().width;widthOfDiv<600&&void 0!==config.default.pnrmHeightSmall?pnrmDiv.style.height=Number(config.default.pnrmHeightSmall)+"px":widthOfDiv>1440&&void 0!==config.default.pnrmHeightLarge?pnrmDiv.style.height=Number(config.default.pnrmHeightLarge)+"px":void 0!==config.default.pnrmHeight&&(pnrmDiv.style.height=Number(config.default.pnrmHeight)+"px")}function calculatePnrmHandleMoveDisplay(){var pnrmHandleMove=viewerDiv.querySelector(".box-main-interface .pnrm-handle-move"),widthOfDiv=viewerDiv.getBoundingClientRect().width,heightOfDiv=viewerDiv.getBoundingClientRect().height;widthOfDiv<600&&heightOfDiv>200?pnrmHandleMove&&pnrmHandleMove.setAttribute("style","display: block;"):pnrmHandleMove&&pnrmHandleMove.setAttribute("style","display: none;")}function addInfoSpotClickHandlerFunc(){for(let key in config.scenes){var scene=config.scenes[key];if(void 0!==scene.hotSpots)for(var i=0;i<scene.hotSpots.length;i++)"info"===scene.hotSpots[i].type&&(scene.hotSpots[i].clickHandlerFunc=infospotClickHandler)}}function infospotClickHandler(e,clickArgs){if("A"!==e.target.nodeName){var hsId=clickArgs.hsId;null!=hsId&&showInfoOverlay(hsId)}}function showInfoOverlay(hsId){var scene,hs=config.scenes[pano.getScene()].hotSpots.find((function(hotspot){return hotspot.id==hsId}));if(void 0!==hs&&"info"===hs.type&&hs.infoImage){var pInfoTitle=viewerDiv.querySelector(".info-overlay .info-title"),imgInfoImage=viewerDiv.querySelector(".info-overlay .info-image");if(pInfoTitle.textContent=hs.text,hs.infoURL){pInfoTitle.innerHTML="";var aInfo=document.createElement("a");aInfo.href=sanitizeURL(hs.infoURL,!0),aInfo.target="_blank";var linkIcon='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link" style="vertical-align: middle;"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>',infoText=void 0!==hs.text?String(hs.text):"";aInfo.innerHTML=infoText+" "+linkIcon,pInfoTitle.appendChild(aInfo)}imgInfoImage.src=sanitizeURL(hs.infoImage,!0),viewerDiv.querySelector(".info-overlay").classList.add("show")}}function addInfoOverlayEvents(){var infoOverlay=viewerDiv.querySelector(".info-overlay"),infoOverlayBoxContent=viewerDiv.querySelector(".info-overlay .box-content"),infoOverlayBtnClose=viewerDiv.querySelector(".info-overlay .close-icon");infoOverlayBoxContent.onclick=function(e){e.stopPropagation()},infoOverlay.onclick=infoOverlayBtnClose.onclick=function(){infoOverlay.classList.remove("show")}}jQuery.post(pnrm_ajax_object.ajax_url,dataToSend).done((function(response){response.error?console.log(response.error):(configJson=response.data,config=JSON.parse(configJson),correctHttpProtocol(),removeDefaultSceneHfov(),calculateHfovFromPnrmHfov(),calculateHeightForScreenSizes(),applyConfigToMainLogo(),checkStartSceneInShortcode(),pano=pannellumMod.viewer(pnrmDiv,config),addInfoSpotClickHandlerFunc(),addInfoOverlayEvents(),handlePnrmAudio(),handleFullscreen(),handleThumbnailBar(),pano.on("scenechange",handlePreviewSceneChange),callback(config,configJson,pano))})).fail((function(xhr,status,error){console.log(error)}))}function sanitizeURL(url,href){try{var decoded_url=decodeURIComponent(unescape(url)).replace(/[^\w:]/g,"").toLowerCase()}catch(e){return"about:blank"}return 0===decoded_url.indexOf("javascript:")||0===decoded_url.indexOf("vbscript:")?(console.log("Script URL removed."),"about:blank"):href&&0===decoded_url.indexOf("data:")?(console.log("Data URI removed from link."),"about:blank"):url}function unescape(html){return html.replace(/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/gi,(function(_,n){return"colon"===(n=n.toLowerCase())?":":"#"===n.charAt(0)?"x"===n.charAt(1)?String.fromCharCode(parseInt(n.substring(2),16)):String.fromCharCode(+n.substring(1)):""}))}function sanitizeURLForCss(url){return sanitizeURL(url).replace(/"/g,"%22").replace(/'/g,"%27")}}();