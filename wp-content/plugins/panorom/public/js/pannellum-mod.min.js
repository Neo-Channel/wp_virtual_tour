/*
 * Pannellum - An HTML5 based Panorama Viewer
 * Copyright (c) 2011-2019 Matthew Petroff
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
window.pannellumMod=function(window,document,undefined){"use strict";function Viewer(container,initialConfig){var _this=this,config,renderer,preview,isUserInteracting=!1,latestInteraction=Date.now(),onPointerDownPointerX=0,onPointerDownPointerY=0,onPointerDownPointerDist=-1,onPointerDownYaw=0,onPointerDownPitch=0,keysDown=new Array(10),fullscreenActive=!1,loaded,error=!1,isTimedOut=!1,listenersAdded=!1,panoImage,prevTime,speed={yaw:0,pitch:0,hfov:0},animating=!1,orientation=!1,orientationYawOffset=0,autoRotateStart,autoRotateSpeed=0,origHfov,origPitch,animatedMove={},externalEventListeners={},specifiedPhotoSphereExcludes=[],update=!1,eps=1e-6,hotspotsCreated=!1,destroyed=!1,defaultConfig={hfov:100,minHfov:50,multiResMinHfov:!1,maxHfov:120,pitch:0,minPitch:void 0,maxPitch:void 0,yaw:0,minYaw:-180,maxYaw:180,roll:0,haov:360,vaov:180,vOffset:0,autoRotate:!1,autoRotateInactivityDelay:-1,autoRotateStopDelay:void 0,type:"equirectangular",northOffset:0,showFullscreenCtrl:!0,dynamic:!1,dynamicUpdate:!1,doubleClickZoom:!0,keyboardZoom:!0,mouseZoom:!0,showZoomCtrl:!0,autoLoad:!1,showControls:!0,orientationOnByDefault:!1,hotSpotDebug:!1,backgroundColor:[0,0,0],avoidShowingBackground:!1,animationTimingFunction:timingFunction,draggable:!0,disableKeyboardCtrl:!1,crossOrigin:"anonymous",touchPanSpeedCoeffFactor:1,capturedKeyNumbers:[16,17,27,37,38,39,40,61,65,68,83,87,107,109,173,187,189],friction:.15,strings:{loadButtonLabel:"Click to<br>Load<br>Panorama",loadingLabel:"Loading...",bylineLabel:"by %s",noPanoramaError:"No panorama image was specified.",fileAccessError:"The file %s could not be accessed.",malformedURLError:"There is something wrong with the panorama URL.",iOS8WebGLError:"Due to iOS 8's broken WebGL implementation, only progressive encoded JPEGs work for your device (this panorama uses standard encoding).",genericWebGLError:"Your browser does not have the necessary WebGL support to display this panorama.",textureSizeError:"This panorama is too big for your device! It's %spx wide, but your device only supports images up to %spx wide. Try another device. (If you're the author, try scaling down the image.)",unknownError:"Unknown error. Check developer console."}};(container="string"==typeof container?document.getElementById(container):container).classList.add("pnrm-pnlm-container"),container.tabIndex=0;var uiContainer=document.createElement("div");uiContainer.className="pnrm-pnlm-ui",container.appendChild(uiContainer);var renderContainer=document.createElement("div");renderContainer.className="pnrm-pnlm-render-container",container.appendChild(renderContainer);var dragFix=document.createElement("div");dragFix.className="pnrm-pnlm-dragfix",uiContainer.appendChild(dragFix);var aboutMsg=document.createElement("span");aboutMsg.className="pnrm-pnlm-about-msg",aboutMsg.innerHTML='<a href="https://panorom.com/" target="_blank">Panorom</a>',uiContainer.appendChild(aboutMsg),"undefined"!=typeof panoromEditor?dragFix.addEventListener("contextmenu",panoromEditor.rightClickTop):dragFix.addEventListener("contextmenu",aboutMessage);var infoDisplay={},hotSpotDebugIndicator=document.createElement("div");hotSpotDebugIndicator.className="pnrm-pnlm-sprite pnrm-pnlm-hot-spot-debug-indicator",uiContainer.appendChild(hotSpotDebugIndicator),infoDisplay.container=document.createElement("div"),infoDisplay.container.className="pnrm-pnlm-panorama-info",infoDisplay.title=document.createElement("div"),infoDisplay.title.className="pnrm-pnlm-title-box",infoDisplay.container.appendChild(infoDisplay.title),infoDisplay.author=document.createElement("div"),infoDisplay.author.className="pnrm-pnlm-author-box",infoDisplay.container.appendChild(infoDisplay.author),uiContainer.appendChild(infoDisplay.container),infoDisplay.load={},infoDisplay.load.box=document.createElement("div"),infoDisplay.load.box.className="pnrm-pnlm-load-box",infoDisplay.load.boxp=document.createElement("p"),infoDisplay.load.box.appendChild(infoDisplay.load.boxp),infoDisplay.load.lbox=document.createElement("div"),infoDisplay.load.lbox.className="pnrm-pnlm-lbox",infoDisplay.load.lbox.innerHTML='<div class="pnrm-pnlm-loading"></div>',infoDisplay.load.box.appendChild(infoDisplay.load.lbox),infoDisplay.load.lbar=document.createElement("div"),infoDisplay.load.lbar.className="pnrm-pnlm-lbar",infoDisplay.load.lbarFill=document.createElement("div"),infoDisplay.load.lbarFill.className="pnrm-pnlm-lbar-fill",infoDisplay.load.lbar.appendChild(infoDisplay.load.lbarFill),infoDisplay.load.box.appendChild(infoDisplay.load.lbar),infoDisplay.load.msg=document.createElement("p"),infoDisplay.load.msg.className="pnrm-pnlm-lmsg",infoDisplay.load.box.appendChild(infoDisplay.load.msg),uiContainer.appendChild(infoDisplay.load.box),infoDisplay.errorMsg=document.createElement("div"),infoDisplay.errorMsg.className="pnrm-pnlm-error-msg pnrm-pnlm-info-box",uiContainer.appendChild(infoDisplay.errorMsg);var controls={};controls.container=document.createElement("div"),controls.container.className="pnrm-pnlm-controls-container",uiContainer.appendChild(controls.container),controls.load=document.createElement("div"),controls.load.className="pnrm-pnlm-load-button",controls.load.addEventListener("click",(function(){processOptions(),load()})),uiContainer.appendChild(controls.load);var boxMainInterfaceTop=container.parentElement,insertIntoPnlmUi=boxMainInterfaceTop.querySelector(".inside-ui")?boxMainInterfaceTop.querySelector(".inside-ui").cloneNode(!0):null;insertIntoPnlmUi&&insertIntoPnlmUi.setAttribute("style",""),insertIntoPnlmUi&&void 0!==insertIntoPnlmUi.dataset.insert&&"off"!==insertIntoPnlmUi.dataset.insert&&uiContainer.appendChild(insertIntoPnlmUi),controls.zoom=document.createElement("div"),controls.zoom.className="pnrm-pnlm-zoom-controls pnrm-pnlm-controls",controls.zoomIn=document.createElement("div"),controls.zoomIn.className="pnrm-pnlm-zoom-in pnrm-pnlm-sprite pnrm-pnlm-control",controls.zoomIn.addEventListener("click",zoomIn),controls.zoom.appendChild(controls.zoomIn),controls.zoomOut=document.createElement("div"),controls.zoomOut.className="pnrm-pnlm-zoom-out pnrm-pnlm-sprite pnrm-pnlm-control",controls.zoomOut.addEventListener("click",zoomOut),controls.zoom.appendChild(controls.zoomOut),controls.container.appendChild(controls.zoom),controls.fullscreen=document.createElement("div"),controls.fullscreen.addEventListener("click",toggleFullscreen),controls.fullscreen.className="pnrm-pnlm-fullscreen-toggle-button pnrm-pnlm-sprite pnrm-pnlm-fullscreen-toggle-button-inactive pnrm-pnlm-controls pnrm-pnlm-control",(document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled||document.msFullscreenEnabled)&&controls.container.appendChild(controls.fullscreen),controls.orientation=document.createElement("div"),controls.orientation.addEventListener("click",(function(e){orientation?stopOrientation():startOrientation()})),controls.orientation.addEventListener("mousedown",(function(e){e.stopPropagation()})),controls.orientation.addEventListener("touchstart",(function(e){e.stopPropagation()})),controls.orientation.addEventListener("pointerdown",(function(e){e.stopPropagation()})),controls.orientation.className="pnrm-pnlm-orientation-button pnrm-pnlm-orientation-button-inactive pnrm-pnlm-sprite pnrm-pnlm-controls pnrm-pnlm-control";var orientationSupport=!1;window.DeviceOrientationEvent&&"https:"==location.protocol&&navigator.userAgent.toLowerCase().indexOf("mobi")>=0&&(controls.container.appendChild(controls.orientation),orientationSupport=!0);var compass=document.createElement("div");function init(){var div=document.createElement("div");if(div.innerHTML="\x3c!--[if lte IE 9]><i></i><![endif]--\x3e",1!=div.getElementsByTagName("i").length){var i,p;if(origHfov=config.hfov,origPitch=config.pitch,"cubemap"==config.type){for(panoImage=[],i=0;i<6;i++)panoImage.push(new Image),panoImage[i].crossOrigin=config.crossOrigin;infoDisplay.load.lbox.style.display="block",infoDisplay.load.lbar.style.display="none"}else if("multires"==config.type){var c=JSON.parse(JSON.stringify(config.multiRes));config.basePath&&config.multiRes.basePath&&!/^(?:[a-z]+:)?\/\//i.test(config.multiRes.basePath)?c.basePath=config.basePath+config.multiRes.basePath:config.multiRes.basePath?c.basePath=config.multiRes.basePath:config.basePath&&(c.basePath=config.basePath),panoImage=c}else if(!0===config.dynamic)panoImage=config.panorama;else{if(void 0===config.panorama)return void anError(config.strings.noPanoramaError);panoImage=new Image}if("cubemap"==config.type){var itemsToLoad=6,onLoad=function(){0===--itemsToLoad&&onImageLoad()},onError=function(e){var a=document.createElement("a");a.href=e.target.src,a.textContent=a.href,anError(config.strings.fileAccessError.replace("%s",a.outerHTML))};for(i=0;i<panoImage.length;i++)"null"==(p=config.cubeMap[i])?(console.log("Will use background instead of missing cubemap face "+i),onLoad()):(config.basePath&&!absoluteURL(p)&&(p=config.basePath+p),panoImage[i].onload=onLoad,panoImage[i].onerror=onError,panoImage[i].src=sanitizeURL(p))}else if("multires"==config.type)onImageLoad();else if(p="",config.basePath&&(p=config.basePath),!0!==config.dynamic){p=absoluteURL(config.panorama)?config.panorama:p+config.panorama,panoImage.onload=function(){window.URL.revokeObjectURL(this.src),onImageLoad()};var xhr=new XMLHttpRequest;xhr.onloadend=function(){if(200!=xhr.status){var a=document.createElement("a");a.href=p,a.textContent=a.href,anError(config.strings.fileAccessError.replace("%s",a.outerHTML))}var img;parseGPanoXMP(this.response),infoDisplay.load.msg.innerHTML=""},xhr.onprogress=function(e){if(e.lengthComputable){var percent=e.loaded/e.total*100,unit,numerator,denominator;infoDisplay.load.lbarFill.style.width=percent+"%",e.total>1e6?(unit="MB",numerator=(e.loaded/1e6).toFixed(2),denominator=(e.total/1e6).toFixed(2)):e.total>1e3?(unit="kB",numerator=(e.loaded/1e3).toFixed(1),denominator=(e.total/1e3).toFixed(1)):(unit="B",numerator=e.loaded,denominator=e.total),infoDisplay.load.msg.innerHTML=numerator+" / "+denominator+" "+unit}else infoDisplay.load.lbox.style.display="block",infoDisplay.load.lbar.style.display="none"};try{xhr.open("GET",p,!0)}catch(e){anError(config.strings.malformedURLError)}xhr.responseType="blob",xhr.setRequestHeader("Accept","image/*,*/*;q=0.9"),xhr.withCredentials="use-credentials"===config.crossOrigin,xhr.send()}config.draggable&&uiContainer.classList.add("pnrm-pnlm-grab"),uiContainer.classList.remove("pnrm-pnlm-grabbing"),update=!0===config.dynamicUpdate,config.dynamic&&update&&(panoImage=config.panorama,onImageLoad())}else anError()}function absoluteURL(url){return new RegExp("^(?:[a-z]+:)?//","i").test(url)||"/"==url[0]||"blob:"==url.slice(0,5)}function onImageLoad(){renderer||(renderer=new libpannellum.renderer(renderContainer)),listenersAdded||(listenersAdded=!0,dragFix.addEventListener("mousedown",onDocumentMouseDown,!1),document.addEventListener("mousemove",onDocumentMouseMove,!1),document.addEventListener("mouseup",onDocumentMouseUp,!1),config.mouseZoom&&(uiContainer.addEventListener("mousewheel",onDocumentMouseWheel,!1),uiContainer.addEventListener("DOMMouseScroll",onDocumentMouseWheel,!1)),config.doubleClickZoom&&dragFix.addEventListener("dblclick",onDocumentDoubleClick,!1),container.addEventListener("mozfullscreenchange",onFullScreenChange,!1),container.addEventListener("webkitfullscreenchange",onFullScreenChange,!1),container.addEventListener("msfullscreenchange",onFullScreenChange,!1),container.addEventListener("fullscreenchange",onFullScreenChange,!1),window.addEventListener("resize",onDocumentResize,!1),window.addEventListener("orientationchange",onDocumentResize,!1),config.disableKeyboardCtrl||(container.addEventListener("keydown",onDocumentKeyPress,!1),container.addEventListener("keyup",onDocumentKeyUp,!1),container.addEventListener("blur",clearKeys,!1)),document.addEventListener("mouseleave",onDocumentMouseUp,!1),""===document.documentElement.style.pointerAction&&""===document.documentElement.style.touchAction?(dragFix.addEventListener("pointerdown",onDocumentPointerDown,!1),dragFix.addEventListener("pointermove",onDocumentPointerMove,!1),dragFix.addEventListener("pointerup",onDocumentPointerUp,!1),dragFix.addEventListener("pointerleave",onDocumentPointerUp,!1)):(dragFix.addEventListener("touchstart",onDocumentTouchStart,!1),dragFix.addEventListener("touchmove",onDocumentTouchMove,!1),dragFix.addEventListener("touchend",onDocumentTouchEnd,!1)),window.navigator.pointerEnabled&&(container.style.touchAction="none")),renderInit(),setHfov(config.hfov),setTimeout((function(){isTimedOut=!0}),500)}function parseGPanoXMP(image){var reader=new FileReader;reader.addEventListener("loadend",(function(){var img=reader.result;if(navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 8_/)){var flagIndex=img.indexOf("ÿÂ");(flagIndex<0||flagIndex>65536)&&anError(config.strings.iOS8WebGLError)}var start=img.indexOf("<x:xmpmeta");if(start>-1&&!0!==config.ignoreGPanoXMP){var xmpData=img.substring(start,img.indexOf("</x:xmpmeta>")+12),getTag=function(tag){var result;return xmpData.indexOf(tag+'="')>=0?result=(result=xmpData.substring(xmpData.indexOf(tag+'="')+tag.length+2)).substring(0,result.indexOf('"')):xmpData.indexOf(tag+">")>=0&&(result=(result=xmpData.substring(xmpData.indexOf(tag+">")+tag.length+1)).substring(0,result.indexOf("<"))),void 0!==result?Number(result):null},xmp={fullWidth:getTag("GPano:FullPanoWidthPixels"),croppedWidth:getTag("GPano:CroppedAreaImageWidthPixels"),fullHeight:getTag("GPano:FullPanoHeightPixels"),croppedHeight:getTag("GPano:CroppedAreaImageHeightPixels"),topPixels:getTag("GPano:CroppedAreaTopPixels"),heading:getTag("GPano:PoseHeadingDegrees"),horizonPitch:getTag("GPano:PosePitchDegrees"),horizonRoll:getTag("GPano:PoseRollDegrees")};null!==xmp.fullWidth&&null!==xmp.croppedWidth&&null!==xmp.fullHeight&&null!==xmp.croppedHeight&&null!==xmp.topPixels&&(specifiedPhotoSphereExcludes.indexOf("haov")<0&&(config.haov=xmp.croppedWidth/xmp.fullWidth*360),specifiedPhotoSphereExcludes.indexOf("vaov")<0&&(config.vaov=xmp.croppedHeight/xmp.fullHeight*180),specifiedPhotoSphereExcludes.indexOf("vOffset")<0&&(config.vOffset=-180*((xmp.topPixels+xmp.croppedHeight/2)/xmp.fullHeight-.5)),null!==xmp.heading&&specifiedPhotoSphereExcludes.indexOf("northOffset")<0&&(config.northOffset=xmp.heading,!1!==config.compass&&(config.compass=!0)),null!==xmp.horizonPitch&&null!==xmp.horizonRoll&&(specifiedPhotoSphereExcludes.indexOf("horizonPitch")<0&&(config.horizonPitch=xmp.horizonPitch),specifiedPhotoSphereExcludes.indexOf("horizonRoll")<0&&(config.horizonRoll=xmp.horizonRoll)))}panoImage.src=window.URL.createObjectURL(image)})),void 0!==reader.readAsBinaryString?reader.readAsBinaryString(image):reader.readAsText(image)}function anError(errorMsg){void 0===errorMsg&&(errorMsg=config.strings.genericWebGLError),infoDisplay.errorMsg.innerHTML="<p>"+errorMsg+"</p>",controls.load.style.display="none",infoDisplay.load.box.style.display="none",infoDisplay.errorMsg.style.display="table",error=!0,loaded=void 0,renderContainer.style.display="none",fireEvent("error",errorMsg)}function clearError(){error&&(infoDisplay.load.box.style.display="none",infoDisplay.errorMsg.style.display="none",error=!1,renderContainer.style.display="block",fireEvent("errorcleared"))}function aboutMessage(event){var pos=mousePosition(event);aboutMsg.style.left=pos.x+"px",aboutMsg.style.top=pos.y+"px",clearTimeout(aboutMessage.t1),clearTimeout(aboutMessage.t2),aboutMsg.style.display="block",aboutMsg.style.opacity=1,aboutMessage.t1=setTimeout((function(){aboutMsg.style.opacity=0}),2e3),aboutMessage.t2=setTimeout((function(){aboutMsg.style.display="none"}),2500),event.preventDefault()}function mousePosition(event){var bounds=container.getBoundingClientRect(),pos={};return pos.x=(event.clientX||event.pageX)-bounds.left,pos.y=(event.clientY||event.pageY)-bounds.top,pos}function onDocumentMouseDown(event){if(event.preventDefault(),container.focus(),loaded&&config.draggable){var pos=mousePosition(event);if(config.hotSpotDebug){var coords=mouseEventToCoords(event);console.log("Pitch: "+coords[0]+", Yaw: "+coords[1]+", Center Pitch: "+config.pitch+", Center Yaw: "+config.yaw+", HFOV: "+config.hfov)}stopAnimation(),stopOrientation(),config.roll=0,speed.hfov=0,isUserInteracting=!0,latestInteraction=Date.now(),onPointerDownPointerX=pos.x,onPointerDownPointerY=pos.y,onPointerDownYaw=config.yaw,onPointerDownPitch=config.pitch,uiContainer.classList.add("pnrm-pnlm-grabbing"),uiContainer.classList.remove("pnrm-pnlm-grab"),fireEvent("mousedown",event),animateInit()}}function onDocumentDoubleClick(event){if(config.minHfov===config.hfov)_this.setHfov(origHfov,1e3);else{var coords=mouseEventToCoords(event);_this.lookAt(coords[0],coords[1],config.minHfov,1e3)}}function mouseEventToCoords(event){var pos=mousePosition(event),canvas=renderer.getCanvas(),canvasWidth=canvas.clientWidth,canvasHeight=canvas.clientHeight,x=pos.x/canvasWidth*2-1,y=(1-pos.y/canvasHeight*2)*canvasHeight/canvasWidth,focal=1/Math.tan(config.hfov*Math.PI/360),s=Math.sin(config.pitch*Math.PI/180),c=Math.cos(config.pitch*Math.PI/180),a=focal*c-y*s,root=Math.sqrt(x*x+a*a),pitch=180*Math.atan((y*c+focal*s)/root)/Math.PI,yaw=180*Math.atan2(x/root,a/root)/Math.PI+config.yaw;return yaw<-180&&(yaw+=360),yaw>180&&(yaw-=360),[pitch,yaw]}function onDocumentMouseMove(event){if(isUserInteracting&&loaded){latestInteraction=Date.now();var canvas=renderer.getCanvas(),canvasWidth=canvas.clientWidth,canvasHeight=canvas.clientHeight,pos=mousePosition(event),yaw=180*(Math.atan(onPointerDownPointerX/canvasWidth*2-1)-Math.atan(pos.x/canvasWidth*2-1))/Math.PI*config.hfov/90+onPointerDownYaw;speed.yaw=(yaw-config.yaw)%360*.2,config.yaw=yaw;var vfov=2*Math.atan(Math.tan(config.hfov/360*Math.PI)*canvasHeight/canvasWidth)*180/Math.PI,pitch=180*(Math.atan(pos.y/canvasHeight*2-1)-Math.atan(onPointerDownPointerY/canvasHeight*2-1))/Math.PI*vfov/90+onPointerDownPitch;speed.pitch=.2*(pitch-config.pitch),config.pitch=pitch}}function onDocumentMouseUp(event){isUserInteracting&&(isUserInteracting=!1,Date.now()-latestInteraction>15&&(speed.pitch=speed.yaw=0),uiContainer.classList.add("pnrm-pnlm-grab"),uiContainer.classList.remove("pnrm-pnlm-grabbing"),latestInteraction=Date.now(),fireEvent("mouseup",event))}function onDocumentTouchStart(event){if(loaded&&config.draggable){stopAnimation(),stopOrientation(),config.roll=0,speed.hfov=0;var pos0=mousePosition(event.targetTouches[0]);if(onPointerDownPointerX=pos0.x,onPointerDownPointerY=pos0.y,2==event.targetTouches.length){var pos1=mousePosition(event.targetTouches[1]);onPointerDownPointerX+=.5*(pos1.x-pos0.x),onPointerDownPointerY+=.5*(pos1.y-pos0.y),onPointerDownPointerDist=Math.sqrt((pos0.x-pos1.x)*(pos0.x-pos1.x)+(pos0.y-pos1.y)*(pos0.y-pos1.y))}isUserInteracting=!0,latestInteraction=Date.now(),onPointerDownYaw=config.yaw,onPointerDownPitch=config.pitch,fireEvent("touchstart",event),animateInit()}}function onDocumentTouchMove(event){if(config.draggable&&(event.preventDefault(),loaded&&(latestInteraction=Date.now()),isUserInteracting&&loaded)){var pos0=mousePosition(event.targetTouches[0]),clientX=pos0.x,clientY=pos0.y;if(2==event.targetTouches.length&&-1!=onPointerDownPointerDist){var pos1=mousePosition(event.targetTouches[1]);clientX+=.5*(pos1.x-pos0.x),clientY+=.5*(pos1.y-pos0.y);var clientDist=Math.sqrt((pos0.x-pos1.x)*(pos0.x-pos1.x)+(pos0.y-pos1.y)*(pos0.y-pos1.y));setHfov(config.hfov+.1*(onPointerDownPointerDist-clientDist)),onPointerDownPointerDist=clientDist}var touchmovePanSpeedCoeff=config.hfov/360*config.touchPanSpeedCoeffFactor,yaw=(onPointerDownPointerX-clientX)*touchmovePanSpeedCoeff+onPointerDownYaw;speed.yaw=(yaw-config.yaw)%360*.2,config.yaw=yaw;var pitch=(clientY-onPointerDownPointerY)*touchmovePanSpeedCoeff+onPointerDownPitch;speed.pitch=.2*(pitch-config.pitch),config.pitch=pitch}}function onDocumentTouchEnd(){isUserInteracting=!1,Date.now()-latestInteraction>150&&(speed.pitch=speed.yaw=0),onPointerDownPointerDist=-1,latestInteraction=Date.now(),fireEvent("touchend",event)}compass.className="pnrm-pnlm-compass pnrm-pnlm-controls pnrm-pnlm-control",uiContainer.appendChild(compass),initialConfig.firstScene?mergeConfig(initialConfig.firstScene):initialConfig.default&&initialConfig.default.firstScene?mergeConfig(initialConfig.default.firstScene):mergeConfig(null),processOptions(!0);var pointerIDs=[],pointerCoordinates=[];function onDocumentPointerDown(event){if("touch"==event.pointerType){if(!loaded||!config.draggable)return;pointerIDs.push(event.pointerId),pointerCoordinates.push({clientX:event.clientX,clientY:event.clientY}),event.targetTouches=pointerCoordinates,onDocumentTouchStart(event),event.preventDefault()}}function onDocumentPointerMove(event){if("touch"==event.pointerType){if(!config.draggable)return;for(var i=0;i<pointerIDs.length;i++)if(event.pointerId==pointerIDs[i])return pointerCoordinates[i].clientX=event.clientX,pointerCoordinates[i].clientY=event.clientY,event.targetTouches=pointerCoordinates,onDocumentTouchMove(event),void event.preventDefault()}}function onDocumentPointerUp(event){if("touch"==event.pointerType){for(var defined=!1,i=0;i<pointerIDs.length;i++)event.pointerId==pointerIDs[i]&&(pointerIDs[i]=void 0),pointerIDs[i]&&(defined=!0);defined||(pointerIDs=[],pointerCoordinates=[],onDocumentTouchEnd()),event.preventDefault()}}function onDocumentMouseWheel(event){loaded&&("fullscreenonly"!=config.mouseZoom||fullscreenActive)&&(event.preventDefault(),stopAnimation(),latestInteraction=Date.now(),event.wheelDeltaY?(setHfov(config.hfov-.05*event.wheelDeltaY),speed.hfov=event.wheelDelta<0?1:-1):event.wheelDelta?(setHfov(config.hfov-.05*event.wheelDelta),speed.hfov=event.wheelDelta<0?1:-1):event.detail&&(setHfov(config.hfov+1.5*event.detail),speed.hfov=event.detail>0?1:-1),animateInit())}function onDocumentKeyPress(event){stopAnimation(),latestInteraction=Date.now(),stopOrientation(),config.roll=0;var keynumber=event.which||event.keycode;config.capturedKeyNumbers.indexOf(keynumber)<0||(event.preventDefault(),27==keynumber?fullscreenActive&&toggleFullscreen():changeKey(keynumber,!0))}function clearKeys(){for(var i=0;i<10;i++)keysDown[i]=!1}function onDocumentKeyUp(event){var keynumber=event.which||event.keycode;config.capturedKeyNumbers.indexOf(keynumber)<0||(event.preventDefault(),changeKey(keynumber,!1))}function changeKey(keynumber,value){var keyChanged=!1;switch(keynumber){case 109:case 189:case 17:case 173:keysDown[0]!=value&&(keyChanged=!0),keysDown[0]=value;break;case 107:case 187:case 16:case 61:keysDown[1]!=value&&(keyChanged=!0),keysDown[1]=value;break;case 38:keysDown[2]!=value&&(keyChanged=!0),keysDown[2]=value;break;case 87:keysDown[6]!=value&&(keyChanged=!0),keysDown[6]=value;break;case 40:keysDown[3]!=value&&(keyChanged=!0),keysDown[3]=value;break;case 83:keysDown[7]!=value&&(keyChanged=!0),keysDown[7]=value;break;case 37:keysDown[4]!=value&&(keyChanged=!0),keysDown[4]=value;break;case 65:keysDown[8]!=value&&(keyChanged=!0),keysDown[8]=value;break;case 39:keysDown[5]!=value&&(keyChanged=!0),keysDown[5]=value;break;case 68:keysDown[9]!=value&&(keyChanged=!0),keysDown[9]=value}keyChanged&&value&&(prevTime="undefined"!=typeof performance&&performance.now()?performance.now():Date.now(),animateInit())}function keyRepeat(){if(loaded){var isKeyDown=!1,prevPitch=config.pitch,prevYaw=config.yaw,prevZoom=config.hfov,newTime;newTime="undefined"!=typeof performance&&performance.now()?performance.now():Date.now(),void 0===prevTime&&(prevTime=newTime);var diff=(newTime-prevTime)*config.hfov/1700;if(diff=Math.min(diff,1),keysDown[0]&&!0===config.keyboardZoom&&(setHfov(config.hfov+(.8*speed.hfov+.5)*diff),isKeyDown=!0),keysDown[1]&&!0===config.keyboardZoom&&(setHfov(config.hfov+(.8*speed.hfov-.2)*diff),isKeyDown=!0),(keysDown[2]||keysDown[6])&&(config.pitch+=(.8*speed.pitch+.2)*diff,isKeyDown=!0),(keysDown[3]||keysDown[7])&&(config.pitch+=(.8*speed.pitch-.2)*diff,isKeyDown=!0),(keysDown[4]||keysDown[8])&&(config.yaw+=(.8*speed.yaw-.2)*diff,isKeyDown=!0),(keysDown[5]||keysDown[9])&&(config.yaw+=(.8*speed.yaw+.2)*diff,isKeyDown=!0),isKeyDown&&(latestInteraction=Date.now()),config.autoRotate){if(newTime-prevTime>.001){var timeDiff=(newTime-prevTime)/1e3,yawDiff=(speed.yaw/timeDiff*diff-.2*config.autoRotate)*timeDiff;yawDiff=(-config.autoRotate>0?1:-1)*Math.min(Math.abs(config.autoRotate*timeDiff),Math.abs(yawDiff)),config.yaw+=yawDiff}config.autoRotateStopDelay&&(config.autoRotateStopDelay-=newTime-prevTime,config.autoRotateStopDelay<=0&&(config.autoRotateStopDelay=!1,autoRotateSpeed=config.autoRotate,config.autoRotate=0))}if(animatedMove.pitch&&(animateMove("pitch"),prevPitch=config.pitch),animatedMove.yaw&&(animateMove("yaw"),prevYaw=config.yaw),animatedMove.hfov&&(animateMove("hfov"),prevZoom=config.hfov),diff>0&&!config.autoRotate){var slowDownFactor=1-config.friction;keysDown[4]||keysDown[5]||keysDown[8]||keysDown[9]||animatedMove.yaw||(config.yaw+=speed.yaw*diff*slowDownFactor),keysDown[2]||keysDown[3]||keysDown[6]||keysDown[7]||animatedMove.pitch||(config.pitch+=speed.pitch*diff*slowDownFactor),keysDown[0]||keysDown[1]||animatedMove.hfov||setHfov(config.hfov+speed.hfov*diff*slowDownFactor)}if(prevTime=newTime,diff>0){speed.yaw=.8*speed.yaw+(config.yaw-prevYaw)/diff*.2,speed.pitch=.8*speed.pitch+(config.pitch-prevPitch)/diff*.2,speed.hfov=.8*speed.hfov+(config.hfov-prevZoom)/diff*.2;var maxSpeed=config.autoRotate?Math.abs(config.autoRotate):5;speed.yaw=Math.min(maxSpeed,Math.max(speed.yaw,-maxSpeed)),speed.pitch=Math.min(maxSpeed,Math.max(speed.pitch,-maxSpeed)),speed.hfov=Math.min(maxSpeed,Math.max(speed.hfov,-maxSpeed))}keysDown[0]&&keysDown[1]&&(speed.hfov=0),(keysDown[2]||keysDown[6])&&(keysDown[3]||keysDown[7])&&(speed.pitch=0),(keysDown[4]||keysDown[8])&&(keysDown[5]||keysDown[9])&&(speed.yaw=0)}}function animateMove(axis){var t=animatedMove[axis],normTime=Math.min(1,Math.max((Date.now()-t.startTime)/1e3/(t.duration/1e3),0)),result=t.startPosition+config.animationTimingFunction(normTime)*(t.endPosition-t.startPosition);(t.endPosition>t.startPosition&&result>=t.endPosition||t.endPosition<t.startPosition&&result<=t.endPosition||t.endPosition===t.startPosition)&&(result=t.endPosition,speed[axis]=0,delete animatedMove[axis]),config[axis]=result}function timingFunction(t){return t<.5?2*t*t:(4-2*t)*t-1}function onDocumentResize(){onFullScreenChange("resize")}function animateInit(){animating||(animating=!0,animate())}function animate(){if(!destroyed)if(render(),autoRotateStart&&clearTimeout(autoRotateStart),isUserInteracting||!0===orientation)requestAnimationFrame(animate);else if(keysDown[0]||keysDown[1]||keysDown[2]||keysDown[3]||keysDown[4]||keysDown[5]||keysDown[6]||keysDown[7]||keysDown[8]||keysDown[9]||config.autoRotate||animatedMove.pitch||animatedMove.yaw||animatedMove.hfov||Math.abs(speed.yaw)>.01||Math.abs(speed.pitch)>.01||Math.abs(speed.hfov)>.01)keyRepeat(),config.autoRotateInactivityDelay>=0&&autoRotateSpeed&&Date.now()-latestInteraction>config.autoRotateInactivityDelay&&!config.autoRotate&&(config.autoRotate=autoRotateSpeed,_this.lookAt(origPitch,void 0,origHfov,3e3)),requestAnimationFrame(animate);else if(renderer&&(renderer.isLoading()||!0===config.dynamic&&update))requestAnimationFrame(animate);else{fireEvent("animatefinished",{pitch:_this.getPitch(),yaw:_this.getYaw(),hfov:_this.getHfov()}),animating=!1,prevTime=void 0;var autoRotateStartTime=config.autoRotateInactivityDelay-(Date.now()-latestInteraction);autoRotateStartTime>0?autoRotateStart=setTimeout((function(){config.autoRotate=autoRotateSpeed,_this.lookAt(origPitch,void 0,origHfov,3e3),animateInit()}),autoRotateStartTime):config.autoRotateInactivityDelay>=0&&autoRotateSpeed&&(config.autoRotate=autoRotateSpeed,_this.lookAt(origPitch,void 0,origHfov,3e3),animateInit())}}function render(){var tmpyaw;if(loaded){var canvas=renderer.getCanvas();!1!==config.autoRotate&&(config.yaw>360?config.yaw-=360:config.yaw<-360&&(config.yaw+=360)),tmpyaw=config.yaw;var hoffcut=0,voffcut=0;if(config.avoidShowingBackground){var hfov2=config.hfov/2,vfov2=180*Math.atan2(Math.tan(hfov2/180*Math.PI),canvas.width/canvas.height)/Math.PI,transposed;config.vaov>config.haov?voffcut=vfov2*(1-Math.min(Math.cos((config.pitch-hfov2)/180*Math.PI),Math.cos((config.pitch+hfov2)/180*Math.PI))):hoffcut=hfov2*(1-Math.min(Math.cos((config.pitch-vfov2)/180*Math.PI),Math.cos((config.pitch+vfov2)/180*Math.PI)))}var yawRange=config.maxYaw-config.minYaw,minYaw=-180,maxYaw=180;yawRange<360&&(minYaw=config.minYaw+config.hfov/2+hoffcut,maxYaw=config.maxYaw-config.hfov/2-hoffcut,yawRange<config.hfov&&(minYaw=maxYaw=(minYaw+maxYaw)/2),config.yaw=Math.max(minYaw,Math.min(maxYaw,config.yaw))),!1===config.autoRotate&&(config.yaw>360?config.yaw-=360:config.yaw<-360&&(config.yaw+=360)),!1!==config.autoRotate&&tmpyaw!=config.yaw&&void 0!==prevTime&&(config.autoRotate*=-1);var vfov=2*Math.atan(Math.tan(config.hfov/180*Math.PI*.5)/(canvas.width/canvas.height))/Math.PI*180,minPitch=config.minPitch+vfov/2,maxPitch=config.maxPitch-vfov/2,pitchRange;config.maxPitch-config.minPitch<vfov&&(minPitch=maxPitch=(minPitch+maxPitch)/2),isNaN(minPitch)&&(minPitch=-90),isNaN(maxPitch)&&(maxPitch=90),config.pitch=Math.max(minPitch,Math.min(maxPitch,config.pitch)),renderer.render(config.pitch*Math.PI/180,config.yaw*Math.PI/180,config.hfov*Math.PI/180,{roll:config.roll*Math.PI/180}),renderHotSpots(),config.compass&&(compass.style.transform="rotate("+(-config.yaw-config.northOffset)+"deg)",compass.style.webkitTransform="rotate("+(-config.yaw-config.northOffset)+"deg)")}}function Quaternion(w,x,y,z){this.w=w,this.x=x,this.y=y,this.z=z}function taitBryanToQuaternion(alpha,beta,gamma){var r=[beta?beta*Math.PI/180/2:0,gamma?gamma*Math.PI/180/2:0,alpha?alpha*Math.PI/180/2:0],c=[Math.cos(r[0]),Math.cos(r[1]),Math.cos(r[2])],s=[Math.sin(r[0]),Math.sin(r[1]),Math.sin(r[2])];return new Quaternion(c[0]*c[1]*c[2]-s[0]*s[1]*s[2],s[0]*c[1]*c[2]-c[0]*s[1]*s[2],c[0]*s[1]*c[2]+s[0]*c[1]*s[2],c[0]*c[1]*s[2]+s[0]*s[1]*c[2])}function computeQuaternion(alpha,beta,gamma){var quaternion=taitBryanToQuaternion(alpha,beta,gamma);quaternion=quaternion.multiply(new Quaternion(Math.sqrt(.5),-Math.sqrt(.5),0,0));var angle=window.orientation?-window.orientation*Math.PI/180/2:0;return quaternion.multiply(new Quaternion(Math.cos(angle),0,-Math.sin(angle),0))}function orientationListener(e){var q=computeQuaternion(e.alpha,e.beta,e.gamma).toEulerAngles();"number"==typeof orientation&&orientation<10?orientation+=1:10===orientation?(orientationYawOffset=q[2]/Math.PI*180+config.yaw,orientation=!0,requestAnimationFrame(animate)):(config.pitch=q[0]/Math.PI*180,config.roll=-q[1]/Math.PI*180,config.yaw=-q[2]/Math.PI*180+orientationYawOffset)}function renderInit(){try{var params={};void 0!==config.horizonPitch&&(params.horizonPitch=config.horizonPitch*Math.PI/180),void 0!==config.horizonRoll&&(params.horizonRoll=config.horizonRoll*Math.PI/180),void 0!==config.backgroundColor&&(params.backgroundColor=config.backgroundColor),renderer.init(panoImage,config.type,config.dynamic,config.haov*Math.PI/180,config.vaov*Math.PI/180,config.vOffset*Math.PI/180,renderInitCallback,params),!0!==config.dynamic&&(panoImage=void 0)}catch(event){if("webgl error"==event.type||"no webgl"==event.type)anError();else{if("webgl size error"!=event.type)throw anError(config.strings.unknownError),event;anError(config.strings.textureSizeError.replace("%s",event.width).replace("%s",event.maxWidth))}}}function renderInitCallback(){if(config.sceneFadeDuration&&void 0!==renderer.fadeImg){renderer.fadeImg.style.opacity=0;var fadeImg=renderer.fadeImg;delete renderer.fadeImg,setTimeout((function(){renderContainer.removeChild(fadeImg),fireEvent("scenechangefadedone")}),config.sceneFadeDuration)}config.compass?compass.style.display="inline":compass.style.display="none",createHotSpots(),infoDisplay.load.box.style.display="none",void 0!==preview&&(renderContainer.removeChild(preview),preview=void 0),loaded=!0,fireEvent("load"),animateInit()}function createHotSpot(hs){hs.pitch=Number(hs.pitch)||0,hs.yaw=Number(hs.yaw)||0;var initialIconColor="#222222",initialIconSize=15,initialIconBackgroundColor="#ffffff",initialIconBackgroundOpacity=.8,initialIconBackgroundSize=30,div=document.createElement("div");div.className="pnrm-pnlm-hotspot-base",hs.cssClass&&hs.cssClass.includes("pnrm-hotspot-show-always")&&(div.className+=" pnrm-hotspot-show-always"),hs.pnrmIconName?(div.style.width=(config.default.pnrmIconBackgroundSize?config.default.pnrmIconBackgroundSize:30)+"px",div.style.height=(config.default.pnrmIconBackgroundSize?config.default.pnrmIconBackgroundSize:30)+"px"):div.className+=" pnrm-pnlm-hotspot pnrm-pnlm-sprite pnrm-pnlm-"+escapeHTML(hs.type);var span=document.createElement("span"),a;if(hs.text&&(span.innerHTML=escapeHTML(hs.text)),"info"==hs.type&&hs.infoURL){span.innerHTML="";var aInfo=document.createElement("a");aInfo.href=sanitizeURL(hs.infoURL,!0),aInfo.target="_blank",aInfo.setAttribute("style","color: #fff");var linkIcon='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link" style="vertical-align: middle;"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>',infoText=void 0!==hs.text?escapeHTML(hs.text):"";aInfo.innerHTML=infoText+" "+linkIcon,span.appendChild(aInfo)}if(hs.video){var video=document.createElement("video"),vidp=hs.video;config.basePath&&!absoluteURL(vidp)&&(vidp=config.basePath+vidp),video.src=sanitizeURL(vidp),video.controls=!0,video.style.width=hs.width+"px",renderContainer.appendChild(div),span.appendChild(video)}else if(hs.image){var imgp=hs.image,image;config.basePath&&!absoluteURL(imgp)&&(imgp=config.basePath+imgp),(a=document.createElement("a")).href=sanitizeURL(hs.URL?hs.URL:imgp,!0),a.target="_blank",span.appendChild(a),(image=document.createElement("img")).src=sanitizeURL(imgp),image.style.width=hs.width+"px",image.style.paddingTop="5px",renderContainer.appendChild(div),a.appendChild(image),span.style.maxWidth="initial"}else if(hs.URL){if((a=document.createElement("a")).href=sanitizeURL(hs.URL,!0),hs.attributes)for(var key in hs.attributes)a.setAttribute(key,hs.attributes[key]);else a.target="_blank";renderContainer.appendChild(a),div.className+=" pnrm-pnlm-pointer",span.className+=" pnrm-pnlm-pointer",a.appendChild(div)}else hs.sceneId&&(div.onclick=div.ontouchend=function(){return div.clicked||(div.clicked=!0,loadScene(hs.sceneId,hs.targetPitch,hs.targetYaw,hs.targetHfov)),!1},div.className+=" pnrm-pnlm-pointer",span.className+=" pnrm-pnlm-pointer"),renderContainer.appendChild(div);if("info"==hs.type)if(hs.infoVideo){var video;(video=document.createElement("video")).oncanplay=function(){span.style.width=span.scrollWidth-10+"px",hs.infoWidth&&(span.style.width=hs.infoWidth+"px"),span.style.marginLeft=-(span.scrollWidth-div.offsetWidth)/2+"px",span.style.marginTop=-span.scrollHeight-12+"px"};var vidp=hs.infoVideo;config.basePath&&!absoluteURL(vidp)&&(vidp=config.basePath+vidp),video.src=sanitizeURL(vidp),video.controls=!0,video.style.maxWidth="100%",video.style.display="block",video.style.margin="10px auto",hs.infoVideoAutoplay&&(video.autoplay=!0,video.muted=!0),hs.infoVideoLoop&&(video.loop=!0),renderContainer.appendChild(div),span.appendChild(video),span.style.maxWidth="initial"}else if(hs.infoImage){var image;(image=document.createElement("img")).onload=function(){span.style.width=span.scrollWidth-10+"px",hs.infoWidth&&(span.style.width=hs.infoWidth+"px"),span.style.marginLeft=-(span.scrollWidth-div.offsetWidth)/2+"px",span.style.marginTop=-span.scrollHeight-12+"px"};var imgp=hs.infoImage;config.basePath&&!absoluteURL(imgp)&&(imgp=config.basePath+imgp),image.src=sanitizeURL(imgp),image.style.maxWidth="100%",image.style.display="block",image.style.margin="10px auto",renderContainer.appendChild(div),span.appendChild(image),span.style.maxWidth="initial"}if(hs.createTooltipFunc?hs.createTooltipFunc(div,hs.createTooltipArgs):(hs.text||hs.video||hs.image||hs.infoImage||hs.infoVideo||hs.infoURL)&&(div.classList.add("pnrm-pnlm-tooltip"),div.appendChild(span),span.style.width=span.scrollWidth-20+"px","info"==hs.type&&hs.infoWidth&&(span.style.maxWidth="initial",span.style.width=hs.infoWidth+"px"),"scene"==hs.type&&hs.hotWidth&&(span.style.maxWidth="initial",span.style.width=hs.hotWidth+"px"),span.style.marginLeft=-(span.scrollWidth-div.offsetWidth)/2+"px",span.style.marginTop=-span.scrollHeight-12+"px"),hs.clickHandlerFunc&&(div.addEventListener("click",(function(e){void 0===hs.infoVideo&&hs.clickHandlerFunc(e,hs.clickHandlerArgs)}),"false"),div.className+=" pnrm-pnlm-pointer",span.className+=" pnrm-pnlm-pointer"),hs.pnrmIconName){var iIcon=document.createElement("i");iIcon.className="fa-solid "+hs.pnrmIconName,iIcon.style.borderRadius="50%",iIcon.style.textAlign="center",iIcon.style.verticalAlign="middle",iIcon.style.display="table-cell",iIcon.style.color=config.default.pnrmIconColor?config.default.pnrmIconColor:"#222222",iIcon.style.width=(config.default.pnrmIconBackgroundSize?config.default.pnrmIconBackgroundSize:30)+"px",iIcon.style.height=(config.default.pnrmIconBackgroundSize?config.default.pnrmIconBackgroundSize:30)+"px",iIcon.style.fontSize=(config.default.pnrmIconSize?config.default.pnrmIconSize:15)+"px";var hex=config.default.pnrmIconBackgroundColor?config.default.pnrmIconBackgroundColor:"#ffffff",opacity=config.default.pnrmIconBackgroundOpacity?config.default.pnrmIconBackgroundOpacity:.8,rgbObj=pnrmHexToRgb(hex),rgba="rgba("+rgbObj.r+","+rgbObj.g+","+rgbObj.b+","+opacity+")";if(iIcon.style.backgroundColor=rgba,config.default.pnrmIconToTooltip&&(span.style.color=config.default.pnrmIconColor?config.default.pnrmIconColor:"#222222"),config.default.pnrmIconToTooltip&&(span.style.backgroundColor=rgba,span.style.borderTopColor=rgba),hs.pnrmIconAnimation){var iAnime=document.createElement("i");iAnime.className="pnrm-box-animation show",iAnime.style.borderColor=rgba,div.appendChild(iAnime)}div.appendChild(iIcon)}"undfined"!=typeof panoromEditor&&hs.rightClickHandlerFunc&&hs.id&&div.addEventListener("contextmenu",(function(e){hs.rightClickHandlerFunc(e,hs.rightClickHandlerArgs)}),"false"),hs.div=div}function pnrmHexToRgb(hex){var result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);return result?{r:parseInt(result[1],16),g:parseInt(result[2],16),b:parseInt(result[3],16)}:null}function createHotSpots(){hotspotsCreated||(config.hotSpots?(config.hotSpots=config.hotSpots.sort((function(a,b){return a.pitch<b.pitch})),config.hotSpots.forEach(createHotSpot)):config.hotSpots=[],hotspotsCreated=!0,renderHotSpots())}function destroyHotSpots(){var hs=config.hotSpots;if(hotspotsCreated=!1,delete config.hotSpots,hs)for(var i=0;i<hs.length;i++){var current=hs[i].div;if(current){for(;current.parentNode&&current.parentNode!=renderContainer;)current=current.parentNode;current instanceof Element&&renderContainer.removeChild(current)}delete hs[i].div}}function renderHotSpot(hs){var hsPitchSin=Math.sin(hs.pitch*Math.PI/180),hsPitchCos=Math.cos(hs.pitch*Math.PI/180),configPitchSin=Math.sin(config.pitch*Math.PI/180),configPitchCos=Math.cos(config.pitch*Math.PI/180),yawCos=Math.cos((-hs.yaw+config.yaw)*Math.PI/180),z=hsPitchSin*configPitchSin+hsPitchCos*yawCos*configPitchCos;if(hs.yaw<=90&&hs.yaw>-90&&z<=0||(hs.yaw>90||hs.yaw<=-90)&&z<=0)hs.div.style.visibility="hidden";else{var yawSin=Math.sin((-hs.yaw+config.yaw)*Math.PI/180),hfovTan=Math.tan(config.hfov*Math.PI/360);hs.div.style.visibility="visible";var canvas=renderer.getCanvas(),canvasWidth=canvas.clientWidth,canvasHeight=canvas.clientHeight,coord=[-canvasWidth/hfovTan*yawSin*hsPitchCos/z/2,-canvasWidth/hfovTan*(hsPitchSin*configPitchCos-hsPitchCos*yawCos*configPitchSin)/z/2],rollSin=Math.sin(config.roll*Math.PI/180),rollCos=Math.cos(config.roll*Math.PI/180);(coord=[coord[0]*rollCos-coord[1]*rollSin,coord[0]*rollSin+coord[1]*rollCos])[0]+=(canvasWidth-hs.div.offsetWidth)/2,coord[1]+=(canvasHeight-hs.div.offsetHeight)/2;var transform="translate("+coord[0]+"px, "+coord[1]+"px) translateZ(9999px) rotate("+config.roll+"deg)";hs.scale&&(transform+=" scale("+origHfov/config.hfov/z+")"),hs.div.style.webkitTransform=transform,hs.div.style.MozTransform=transform,hs.div.style.transform=transform}}function renderHotSpots(){config.hotSpots.forEach(renderHotSpot)}function mergeConfig(sceneId){var k,s;config={};var photoSphereExcludes=["haov","vaov","vOffset","northOffset","horizonPitch","horizonRoll"];for(k in specifiedPhotoSphereExcludes=[],defaultConfig)defaultConfig.hasOwnProperty(k)&&(config[k]=defaultConfig[k]);for(k in initialConfig.default)if(initialConfig.default.hasOwnProperty(k))if("strings"==k)for(s in initialConfig.default.strings)initialConfig.default.strings.hasOwnProperty(s)&&(config.strings[s]=escapeHTML(initialConfig.default.strings[s]));else config[k]=initialConfig.default[k],photoSphereExcludes.indexOf(k)>=0&&specifiedPhotoSphereExcludes.push(k);if(null!==sceneId&&""!==sceneId&&initialConfig.scenes&&initialConfig.scenes[sceneId]){var scene=initialConfig.scenes[sceneId];for(k in scene)if(scene.hasOwnProperty(k))if("strings"==k)for(s in scene.strings)scene.strings.hasOwnProperty(s)&&(config.strings[s]=escapeHTML(scene.strings[s]));else config[k]=scene[k],photoSphereExcludes.indexOf(k)>=0&&specifiedPhotoSphereExcludes.push(k);config.scene=sceneId}for(k in initialConfig)if(initialConfig.hasOwnProperty(k))if("strings"==k)for(s in initialConfig.strings)initialConfig.strings.hasOwnProperty(s)&&(config.strings[s]=escapeHTML(initialConfig.strings[s]));else config[k]=initialConfig[k],photoSphereExcludes.indexOf(k)>=0&&specifiedPhotoSphereExcludes.push(k)}function processOptions(isPreview){if((isPreview=isPreview||!1)&&"preview"in config){var p=config.preview;config.basePath&&!absoluteURL(p)&&(p=config.basePath+p),(preview=document.createElement("div")).className="pnrm-pnlm-preview-img",preview.style.backgroundImage="url('"+sanitizeURLForCss(p)+"')",renderContainer.appendChild(preview)}var title=config.title,author=config.author;for(var key in isPreview&&("previewTitle"in config&&(config.title=config.previewTitle),"previewAuthor"in config&&(config.author=config.previewAuthor)),config.hasOwnProperty("title")||(infoDisplay.title.innerHTML=""),config.hasOwnProperty("author")||(infoDisplay.author.innerHTML=""),config.hasOwnProperty("title")||config.hasOwnProperty("author")||(infoDisplay.container.style.display="none"),controls.load.innerHTML="<p>"+config.strings.loadButtonLabel+"</p>",infoDisplay.load.boxp.innerHTML=config.strings.loadingLabel,config)if(config.hasOwnProperty(key))switch(key){case"title":infoDisplay.title.innerHTML=escapeHTML(config[key]),infoDisplay.container.style.display="inline";break;case"author":var authorText=escapeHTML(config[key]);if(config.authorURL){var authorLink=document.createElement("a");authorLink.href=sanitizeURL(config.authorURL,!0),authorLink.target="_blank",authorLink.innerHTML=escapeHTML(config[key]),authorText=authorLink.outerHTML}infoDisplay.author.innerHTML=config.strings.bylineLabel.replace("%s",authorText),infoDisplay.container.style.display="inline";break;case"fallback":var link=document.createElement("a");link.href=sanitizeURL(config[key],!0),link.target="_blank",link.textContent="Click here to view this panorama in an alternative viewer.";var message=document.createElement("p");message.textContent="Your browser does not support WebGL.",message.appendChild(document.createElement("br")),message.appendChild(link),infoDisplay.errorMsg.innerHTML="",infoDisplay.errorMsg.appendChild(message);break;case"hfov":setHfov(Number(config[key]));break;case"autoLoad":!0===config[key]&&void 0===renderer&&(infoDisplay.load.box.style.display="inline",controls.load.style.display="none",init());break;case"showZoomCtrl":config[key]&&0!=config.showControls?controls.zoom.style.display="block":controls.zoom.style.display="none";break;case"showFullscreenCtrl":config[key]&&0!=config.showControls&&("fullscreen"in document||"mozFullScreen"in document||"webkitIsFullScreen"in document||"msFullscreenElement"in document)?controls.fullscreen.style.display="block":controls.fullscreen.style.display="none";break;case"hotSpotDebug":config[key]?hotSpotDebugIndicator.style.display="block":hotSpotDebugIndicator.style.display="none";break;case"showControls":config[key]||(controls.orientation.style.display="none",controls.zoom.style.display="none",controls.fullscreen.style.display="none");break;case"orientationOnByDefault":config[key]&&startOrientation()}isPreview&&(title?config.title=title:delete config.title,author?config.author=author:delete config.author)}function toggleFullscreen(){if(loaded&&!error)if(fullscreenActive)document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen();else try{container.requestFullscreen?container.requestFullscreen():container.mozRequestFullScreen?container.mozRequestFullScreen():container.msRequestFullscreen?container.msRequestFullscreen():container.webkitRequestFullScreen()}catch(event){}}function onFullScreenChange(resize){document.fullscreenElement||document.fullscreen||document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement?(controls.fullscreen.classList.add("pnrm-pnlm-fullscreen-toggle-button-active"),fullscreenActive=!0):(controls.fullscreen.classList.remove("pnrm-pnlm-fullscreen-toggle-button-active"),fullscreenActive=!1),"resize"!==resize&&fireEvent("fullscreenchange",fullscreenActive),renderer.resize(),setHfov(config.hfov),animateInit()}function zoomIn(){loaded&&(setHfov(config.hfov-5),animateInit())}function zoomOut(){loaded&&(setHfov(config.hfov+5),animateInit())}function constrainHfov(hfov){var minHfov=config.minHfov;if("multires"==config.type&&renderer&&!config.multiResMinHfov&&(minHfov=Math.min(minHfov,renderer.getCanvas().width/(config.multiRes.cubeResolution/90*.9))),minHfov>config.maxHfov)return console.log("HFOV bounds do not make sense (minHfov > maxHfov)."),config.hfov;var newHfov=config.hfov;if(newHfov=hfov<minHfov?minHfov:hfov>config.maxHfov?config.maxHfov:hfov,config.avoidShowingBackground&&renderer){var canvas=renderer.getCanvas();newHfov=Math.min(newHfov,360*Math.atan(Math.tan((config.maxPitch-config.minPitch)/360*Math.PI)/canvas.height*canvas.width)/Math.PI)}return newHfov}function setHfov(hfov){config.hfov=constrainHfov(hfov),fireEvent("zoomchange",config.hfov)}function stopAnimation(){animatedMove={},autoRotateSpeed=config.autoRotate?config.autoRotate:autoRotateSpeed,config.autoRotate=!1}function load(){clearError(),loaded=!1,controls.load.style.display="none",infoDisplay.load.box.style.display="inline",init()}function loadScene(sceneId,targetPitch,targetYaw,targetHfov,fadeDone){var fadeImg,workingPitch,workingYaw,workingHfov;if(loaded||(fadeDone=!0),loaded=!1,animatedMove={},config.sceneFadeDuration&&!fadeDone){var data=renderer.render(config.pitch*Math.PI/180,config.yaw*Math.PI/180,config.hfov*Math.PI/180,{returnImage:!0});if(void 0!==data)return(fadeImg=new Image).className="pnrm-pnlm-fade-img",fadeImg.style.transition="opacity "+config.sceneFadeDuration/1e3+"s",fadeImg.style.width="100%",fadeImg.style.height="100%",fadeImg.onload=function(){loadScene(sceneId,targetPitch,targetYaw,targetHfov,!0)},fadeImg.src=data,renderContainer.appendChild(fadeImg),void(renderer.fadeImg=fadeImg)}workingPitch="same"===targetPitch?config.pitch:targetPitch,workingYaw="same"===targetYaw?config.yaw:"sameAzimuth"===targetYaw?config.yaw+(config.northOffset||0)-(initialConfig.scenes[sceneId].northOffset||0):targetYaw,workingHfov="same"===targetHfov?config.hfov:targetHfov,destroyHotSpots(),mergeConfig(sceneId),speed.yaw=speed.pitch=speed.hfov=0,processOptions(),void 0!==workingPitch&&(config.pitch=workingPitch),void 0!==workingYaw&&(config.yaw=workingYaw),void 0!==workingHfov&&(config.hfov=workingHfov),fireEvent("scenechange",sceneId),load()}function stopOrientation(){window.removeEventListener("deviceorientation",orientationListener),controls.orientation.classList.remove("pnrm-pnlm-orientation-button-active"),orientation=!1}function startOrientation(){"function"==typeof DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((function(response){"granted"==response&&(orientation=1,window.addEventListener("deviceorientation",orientationListener),controls.orientation.classList.add("pnrm-pnlm-orientation-button-active"))})):(orientation=1,window.addEventListener("deviceorientation",orientationListener),controls.orientation.classList.add("pnrm-pnlm-orientation-button-active"))}function escapeHTML(s){return initialConfig.escapeHTML?String(s).split(/&/g).join("&amp;").split('"').join("&quot;").split("'").join("&#39;").split("<").join("&lt;").split(">").join("&gt;").split("/").join("&#x2f;").split("\n").join("<br>"):String(s).split("\n").join("<br>")}function sanitizeURL(url,href){try{var decoded_url=decodeURIComponent(unescape(url)).replace(/[^\w:]/g,"").toLowerCase()}catch(e){return"about:blank"}return 0===decoded_url.indexOf("javascript:")||0===decoded_url.indexOf("vbscript:")?(console.log("Script URL removed."),"about:blank"):href&&0===decoded_url.indexOf("data:")?(console.log("Data URI removed from link."),"about:blank"):url}function unescape(html){return html.replace(/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/gi,(function(_,n){return"colon"===(n=n.toLowerCase())?":":"#"===n.charAt(0)?"x"===n.charAt(1)?String.fromCharCode(parseInt(n.substring(2),16)):String.fromCharCode(+n.substring(1)):""}))}function sanitizeURLForCss(url){return sanitizeURL(url).replace(/"/g,"%22").replace(/'/g,"%27")}function fireEvent(type){if(type in externalEventListeners)for(var i=externalEventListeners[type].length;i>0;i--)externalEventListeners[type][externalEventListeners[type].length-i].apply(null,[].slice.call(arguments,1))}Quaternion.prototype.multiply=function(q){return new Quaternion(this.w*q.w-this.x*q.x-this.y*q.y-this.z*q.z,this.x*q.w+this.w*q.x+this.y*q.z-this.z*q.y,this.y*q.w+this.w*q.y+this.z*q.x-this.x*q.z,this.z*q.w+this.w*q.z+this.x*q.y-this.y*q.x)},Quaternion.prototype.toEulerAngles=function(){var phi,theta,psi;return[Math.atan2(2*(this.w*this.x+this.y*this.z),1-2*(this.x*this.x+this.y*this.y)),Math.asin(2*(this.w*this.y-this.z*this.x)),Math.atan2(2*(this.w*this.z+this.x*this.y),1-2*(this.y*this.y+this.z*this.z))]},this.isLoaded=function(){return Boolean(loaded)},this.getPitch=function(){return config.pitch},this.setPitch=function(pitch,animated,callback,callbackArgs){return latestInteraction=Date.now(),Math.abs(pitch-config.pitch)<=eps?("function"==typeof callback&&callback(callbackArgs),this):((animated=null==animated?1e3:Number(animated))?(animatedMove.pitch={startTime:Date.now(),startPosition:config.pitch,endPosition:pitch,duration:animated},"function"==typeof callback&&setTimeout((function(){callback(callbackArgs)}),animated)):config.pitch=pitch,animateInit(),this)},this.getPitchBounds=function(){return[config.minPitch,config.maxPitch]},this.setPitchBounds=function(bounds){return config.minPitch=Math.max(-90,Math.min(bounds[0],90)),config.maxPitch=Math.max(-90,Math.min(bounds[1],90)),this},this.getYaw=function(){return(config.yaw+540)%360-180},this.setYaw=function(yaw,animated,callback,callbackArgs){return latestInteraction=Date.now(),Math.abs(yaw-config.yaw)<=eps?("function"==typeof callback&&callback(callbackArgs),this):(yaw=(yaw+180)%360-180,(animated=null==animated?1e3:Number(animated))?(config.yaw-yaw>180?yaw+=360:yaw-config.yaw>180&&(yaw-=360),animatedMove.yaw={startTime:Date.now(),startPosition:config.yaw,endPosition:yaw,duration:animated},"function"==typeof callback&&setTimeout((function(){callback(callbackArgs)}),animated)):config.yaw=yaw,animateInit(),this)},this.getYawBounds=function(){return[config.minYaw,config.maxYaw]},this.setYawBounds=function(bounds){return config.minYaw=Math.max(-360,Math.min(bounds[0],360)),config.maxYaw=Math.max(-360,Math.min(bounds[1],360)),this},this.getHfov=function(){return config.hfov},this.setHfov=function(hfov,animated,callback,callbackArgs){return latestInteraction=Date.now(),Math.abs(hfov-config.hfov)<=eps?("function"==typeof callback&&callback(callbackArgs),this):((animated=null==animated?1e3:Number(animated))?(animatedMove.hfov={startTime:Date.now(),startPosition:config.hfov,endPosition:constrainHfov(hfov),duration:animated},"function"==typeof callback&&setTimeout((function(){callback(callbackArgs)}),animated)):setHfov(hfov),animateInit(),this)},this.getHfovBounds=function(){return[config.minHfov,config.maxHfov]},this.setHfovBounds=function(bounds){return config.minHfov=Math.max(0,bounds[0]),config.maxHfov=Math.max(0,bounds[1]),this},this.lookAt=function(pitch,yaw,hfov,animated,callback,callbackArgs){return animated=null==animated?1e3:Number(animated),void 0!==pitch&&Math.abs(pitch-config.pitch)>eps&&(this.setPitch(pitch,animated,callback,callbackArgs),callback=void 0),void 0!==yaw&&Math.abs(yaw-config.yaw)>eps&&(this.setYaw(yaw,animated,callback,callbackArgs),callback=void 0),void 0!==hfov&&Math.abs(hfov-config.hfov)>eps&&(this.setHfov(hfov,animated,callback,callbackArgs),callback=void 0),"function"==typeof callback&&callback(callbackArgs),this},this.getNorthOffset=function(){return config.northOffset},this.setNorthOffset=function(heading){return config.northOffset=Math.min(360,Math.max(0,heading)),animateInit(),this},this.getHorizonRoll=function(){return config.horizonRoll},this.setHorizonRoll=function(roll){return config.horizonRoll=Math.min(90,Math.max(-90,roll)),renderer.setPose(config.horizonPitch*Math.PI/180,config.horizonRoll*Math.PI/180),animateInit(),this},this.getHorizonPitch=function(){return config.horizonPitch},this.setHorizonPitch=function(pitch){return config.horizonPitch=Math.min(90,Math.max(-90,pitch)),renderer.setPose(config.horizonPitch*Math.PI/180,config.horizonRoll*Math.PI/180),animateInit(),this},this.startAutoRotate=function(speed,pitch){return speed=speed||autoRotateSpeed||1,pitch=void 0===pitch?origPitch:pitch,config.autoRotate=speed,_this.lookAt(pitch,void 0,origHfov,3e3),animateInit(),this},this.stopAutoRotate=function(){return autoRotateSpeed=config.autoRotate?config.autoRotate:autoRotateSpeed,config.autoRotate=!1,config.autoRotateInactivityDelay=-1,this},this.stopMovement=function(){stopAnimation(),speed={yaw:0,pitch:0,hfov:0}},this.getRenderer=function(){return renderer},this.setUpdate=function(bool){return update=!0===bool,void 0===renderer?onImageLoad():animateInit(),this},this.mouseEventToCoords=function(event){return mouseEventToCoords(event)},this.loadScene=function(sceneId,pitch,yaw,hfov){return!1!==loaded&&loadScene(sceneId,pitch,yaw,hfov),this},this.getScene=function(){return config.scene},this.addScene=function(sceneId,config){return initialConfig.scenes[sceneId]=config,this},this.removeScene=function(sceneId){return!(config.scene===sceneId||!initialConfig.scenes.hasOwnProperty(sceneId))&&(delete initialConfig.scenes[sceneId],!0)},this.toggleFullscreen=function(){return toggleFullscreen(),this},this.getConfig=function(){return config},this.getContainer=function(){return container},this.addHotSpot=function(hs,sceneId){if(void 0===sceneId&&void 0===config.scene)config.hotSpots.push(hs);else{var id=void 0!==sceneId?sceneId:config.scene;if(!initialConfig.scenes.hasOwnProperty(id))throw"Invalid scene ID!";initialConfig.scenes[id].hasOwnProperty("hotSpots")||(initialConfig.scenes[id].hotSpots=[],id==config.scene&&(config.hotSpots=initialConfig.scenes[id].hotSpots)),initialConfig.scenes[id].hotSpots.push(hs)}return void 0!==sceneId&&config.scene!=sceneId||(createHotSpot(hs),loaded&&renderHotSpot(hs)),this},this.removeHotSpot=function(hotSpotId,sceneId){if(void 0===sceneId||config.scene==sceneId){if(!config.hotSpots)return!1;for(var i=0;i<config.hotSpots.length;i++)if(config.hotSpots[i].hasOwnProperty("id")&&config.hotSpots[i].id===hotSpotId){for(var current=config.hotSpots[i].div;current.parentNode!=renderContainer;)current=current.parentNode;return renderContainer.removeChild(current),delete config.hotSpots[i].div,config.hotSpots.splice(i,1),!0}}else{if(!initialConfig.scenes.hasOwnProperty(sceneId))return!1;if(!initialConfig.scenes[sceneId].hasOwnProperty("hotSpots"))return!1;for(var j=0;j<initialConfig.scenes[sceneId].hotSpots.length;j++)if(initialConfig.scenes[sceneId].hotSpots[j].hasOwnProperty("id")&&initialConfig.scenes[sceneId].hotSpots[j].id===hotSpotId)return initialConfig.scenes[sceneId].hotSpots.splice(j,1),!0}},this.resize=function(){renderer&&onDocumentResize()},this.isLoaded=function(){return loaded},this.isOrientationSupported=function(){return orientationSupport||!1},this.stopOrientation=function(){stopOrientation()},this.startOrientation=function(){orientationSupport&&startOrientation()},this.isOrientationActive=function(){return Boolean(orientation)},this.on=function(type,listener){return externalEventListeners[type]=externalEventListeners[type]||[],externalEventListeners[type].push(listener),this},this.off=function(type,listener){if(!type)return externalEventListeners={},this;if(listener){var i=externalEventListeners[type].indexOf(listener);i>=0&&externalEventListeners[type].splice(i,1),0==externalEventListeners[type].length&&delete externalEventListeners[type]}else delete externalEventListeners[type];return this},this.destroy=function(){destroyed=!0,clearTimeout(autoRotateStart),renderer&&renderer.destroy(),listenersAdded&&(document.removeEventListener("mousemove",onDocumentMouseMove,!1),document.removeEventListener("mouseup",onDocumentMouseUp,!1),container.removeEventListener("mozfullscreenchange",onFullScreenChange,!1),container.removeEventListener("webkitfullscreenchange",onFullScreenChange,!1),container.removeEventListener("msfullscreenchange",onFullScreenChange,!1),container.removeEventListener("fullscreenchange",onFullScreenChange,!1),window.removeEventListener("resize",onDocumentResize,!1),window.removeEventListener("orientationchange",onDocumentResize,!1),container.removeEventListener("keydown",onDocumentKeyPress,!1),container.removeEventListener("keyup",onDocumentKeyUp,!1),container.removeEventListener("blur",clearKeys,!1),document.removeEventListener("mouseleave",onDocumentMouseUp,!1)),container.innerHTML="",container.classList.remove("pnrm-pnlm-container")}}return{viewer:function(container,config){return new Viewer(container,config)}}}(window,document);